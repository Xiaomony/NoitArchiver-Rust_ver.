# NoitArchiver 存档器

由于NoitaArchiveManager旧版本（C++版）出现了各种问题，现使用Rust重写了新版本
([本程序旧版本的地址](https://github.com/Xiaomony/NoitaArchiveManager))

## 新版本包含两个版本：命令行版和GUI（带有图形界面）版

- ## 程序说明及介绍视频

- [gitHub主页](https://github.com/Xiaomony/NoitArchiver-Rust_ver.)
- [使用说明及注意事项(务必查看)](#使用说明及注意事项)
- [新版本New Features](#new-features)
- [命令说明](#命令说明)
- [json文件的编辑与修改](#json文件的编辑与修改)
- [实现原理](#实现原理)
- [项目构建](#项目构建)

## 使用说明及注意事项

1. 本程序运行时会在程序所在目录下建立一个 **_Archives文件夹_** 用于存储日志文件和保存的存档,请勿删除(若删除,则相当于恢复程序第一次运行的状态)

2. 建议将程序放在磁盘中的某个文件夹下,再发送到桌面快捷方式使用(避免程序在桌面创建Archive文件夹后被误删)

3. 请在Noita主界面有 **"继续"** 这一选项时读取存档,若没有则请先 **"新游戏"** 后再关闭游戏读档,重新打开后再点击 **"继续"**

4. 建议关闭Steam云存档

5. 请在Noita **_正常保存、关闭_** 后再进行存档(游戏进行中存档的话保存的是Noita的 **自动存档** ,可能是几分钟前的存档,并非保存时的存档)

6. 游戏进行中请勿读取存档

7. 随着游戏的进行,每次存档 **所用的时间** 和 **占用的空间** 也会不断 **增大** ,请耐心等待

8. **本程序的命令行版本支持 传入命令行参数**

9. **使用GUI版时要注意不要同时点击一个按钮多次**

10. **命令行版本与GUI版本可以共用一个Archives文件夹 但千万不要同时运行两个版本的程序**

## New Features

1. 新增favor、unfavor命令、丰富help命令

    favor可以收藏存档，被收藏的存档无法进行任何修改，需先用unfavor取消收藏才能修改

    可使用  `help+命令`  的形式查看某条命令的说明及用法

2. del命令新增了批量删除功能，可使用  `help del`  查看用法

3. 命令参数模式，详见[命令参数模式](#parameter_command_mod)

4. 新版本使用json存储存档信息，并以存档名命名保存的存档文件夹

    这使得用户可以手动编辑存储存档信息的json文件，关于json文件的编辑，详见[json文件的编辑与修改](#json文件的编辑与修改)

5. 新版本的程序图标改为了 **_巨型神圣炸弹_**

## 命令说明

1. 命令的输入可以使用全写，也可以使用缩写(括号里的)

2. 新版本的命令有两种使用方式：命令参数模式和普通模式

    - <a id="parameter_command_mod">命令参数模式：</a>使用类似命令行的方法进行操作，如
        `save 存档1 存档备注`

        在输入命令的同时将其参数一同输入，每个参数用空格隔开，如果存档名、存档备注等任何参数中含有空格，请用  **_英文引号_**（不要用 **_中文引号_** ）  将参数括起来

        `save "存档 1" "存档  备注"`

        每个命令的命令参数模式的格式不同，请用  `help+命令`  的形式查看某条命令的说明及用法
    - 普通模式：如同旧版本一样，先输入命令，再根据程序的提示输入参数，如

        ```bash
        >>>save
        请输入存档名(直接换行则取消保存):存档 1
        请输入存档备注(直接换行则不填):存档备注
        保存成功
        ```

3. 使用`favor`命令收藏的存档 **不可进行任何修改** ，请先使用`unfavor`取消对其收藏才能修改

4. 使用  `help+命令`  的形式查看某条命令的说明及用法

5. del命令在新版本可以使用**批量删除**的功能，具体可使用  `help del`  查看用法

6. 命令列表( **_新版本对部分命令的全写进行了调整，但缩写都没变_** )
    | 命令          | 含义             | 简写  | 说明                           |
    |:-----------:|:--------------:|:---:|:----------------------------:|
    | clear       |                | cls | 清屏                             |
    | help        |                | h   | 帮助及注意事项                      |
    | quit        |                | q   | 退出程序                          |
    | save        |                | s   | 保存（存档）                       |
    | qsave       | quick save     | qs  | 快速保存（无需填写存档名称和备注，存档名会自动生成）   |
    | rsave       | repalce save   | rs  | 保存 且 **覆盖最新存档**（存档名与备注不变，存档时间更新） |
    | load        |                | l   | 指定存档进行读取                     |
    | qload       | quick load     | ql  | 快速读取（最近一次的存档）                |
    | log         |                | lo  | 查看所有存档极其信息                   |
    | slog        | short log      | sl  | 查看近七次存档                |
    | mArchive    | modify Archive | ma  | 修改某个存档的信息                    |
    | delArch     | delete Archive | del | 删除某个存档                       |
    | qDelete     | quick Delete   | qd  | 删除最新的存档                      |
    | favor       |                | f   | 收藏某个存档             |
    | unfavor     |                | unf | 取消收藏某个存档             |
    | usage       |                | use | 查看存档的占用空间            |

## json文件的编辑与修改

本程序使用的json文件的基本格式：

```json
[
    {           //每个存档信息用大括号包裹
        "name": "存档名1",
        "note": "存档备注1",
        "date": [2024, 6, 15],
        "time": [10, 42, 30],
        "is_favored": true  //存档是否被收藏(true和false都是小写)
    },
    ...
    {
        "name": "存档名n",
        "note": "存档备注n",
        "date": [2024, 6, 15],
        "time": [12, 0, 0],
        "is_favored": false
    }           //最后一个存档信息大括号后没有逗号
]               //必须以中括号包裹所有的存档信息
```

如果没有处理过json文件，不建议手动编辑，否则程序可能因json文件格式问题而无法启动

## 实现原理

Noita会在`C:\Users\用户名\AppData\LocalLow\Nolla_Games_Noita`下存储数据，其中的`save00`文件夹为存档数据，通过复制该文件夹的内容并还原以达到存档和读档的目的

## 项目构建

- 命令行版本：

    运行命令：

    ```bat
    cargo build -p noitarchiver_cmd --release
    ```

- GUI版本：

    1. 先配置[tauri环境](https://tauri.app/zh-cn/v1/guides/getting-started/prerequisites)

    2. 运行命令：

    ```bat
    cargo tauri build
    ```
